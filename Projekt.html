<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>

    <style>
        #map-container {
            width: 800px;
            height: 600px;
        }

        .country-label {
            font-size: 12px;
            fill: #000000;
            pointer-events: none;
            visibility: hidden;
        }

        #bar-chart-container {
            width: 600px;
            height: 400px;
        }

        .bar {
            fill: steelblue;
        }

        .bar-label {
            font-size: 12px;
            fill: #000000;
            text-anchor: end;
            transform: rotate(-45deg);
        }

        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }

        .chart-title {
            font-size: 16px;
            font-weight: bold;
        }

        .back-button {
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
        }

        #tooltip {
            position: absolute;
            visibility: hidden;
            background-color: white;
            border: 1px solid gray;

            visibility: hidden;
            width: 120px;

            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
        }

        #tooltip1 {
            position: absolute;
            visibility: hidden;
            background-color: white;
            border: 1px solid gray;

            visibility: hidden;
            width: 120px;

            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
        }

        .map-title {
            font-size: 20px;
            font-weight: bold;
            text-anchor: middle;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            font-size: 14px;
            color: #000000;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-item span {
            display: inline-block;
            width: 20px;
            height: 10px;
            margin-right: 5px;
        }

        .country {
            fill: lightblue;
            stroke: white;
        }

        .country.low {
            fill: #BCD2E8;
        }

        .country.medium {
            fill: #73A5C6;
        }

        .country.high {
            fill: #528AAE;
        }

        .country.higher {
            fill: #2E5984;
        }

        .country.highest {
            fill: #1E3F66;
        }
    </style>
</head>

<body>
    <div id="map-container">
        <div id="tooltip1" style="position: absolute; visibility: hidden;">
            <p><span id="tooltip-country"></span></p>
            <p><span id="tooltip-played1"></span></p>
        </div>
        <div class="legend">
            <div class="legend-item">
                <span style="background-color: #BCD2E8"></span> 0-99
            </div>
            <div class="legend-item">
                <span style="background-color: #73A5C6"></span> 100 - 349
            </div>
            <div class="legend-item">
                <span style="background-color: #528AAE"></span> 350-599
            </div>
            <div class="legend-item">
                <span style="background-color: #2E5984"></span> 600-999
            </div>
            <div class="legend-item">
                <span style="background-color: #1E3F66"></span> 999 and above
            </div>
        </div>
    </div>

    <div id="bar-chart-container" style="display: none;">
        <button class="back-button">Back to Map</button>
        <button class="participated-button">Participation Chart</button>
        <button class="played-button">Played Games Chart</button>
        <button class="scored-button">Goals Scored Chart</button>
        <button class="points-button">Team Points Chart</button>
        <button class="titles-button">Team Titles Chart</button>

    </div>
    <div id="tooltip" style="position: absolute; visibility: hidden;">
        <p><span id="tooltip-club"></span></p>
        <p><span id="tooltip-played"></span></p>
    </div>

    <script>
        var width = 1300;
        var height = 600;

        var svg = d3.select("#map-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        svg.append("text")
            .attr("class", "map-title")
            .attr("x", width / 2)
            .attr("y", 20)
            .style("text-anchor", "middle")
            .text("Countries and Clubs Success in Champions League Map");

        d3.json("europe.json").then(function (europeGeoJSON) {
            var projection = d3.geoMercator()
                .fitSize([width, height], europeGeoJSON)
                .translate([width / 2 - 500, height / 2 + 500])
                .scale([300]);

            var path = d3.geoPath().projection(projection);

            d3.json("AllTimeRankingByCountry.json").then(function (countryData) {
                var minPlayed = d3.min(countryData, function (d) { return d.Played; });
                var maxPlayed = d3.max(countryData, function (d) { return d.Played; });

                var colorScale = d3.scaleLinear()
                    .domain([0, 99, 349, 599, 999, 1999])
                    .range(["lowest", "low", "medium", "high", "higher", "highest"]);

                var countries = svg.selectAll(".country")
                    .data(europeGeoJSON.features)
                    .enter()
                    .append("path")
                    .attr("class", function (d) {
                        var country = countryData.find(function (item) {
                            return item.Country === d.properties.name_en;
                        });
                        if (country) {
                            return "country " + colorScale(country.Played);
                        } else {
                            return "country";
                        }
                    })
                    .attr("d", path)
                    .attr("d", path)
                    .on("mouseover", function (event, d) {

                        var centroid = path.centroid(d);
                        svg.append("text")
                            .attr("class", "country-label")
                            .attr("x", centroid[0])
                            .attr("y", centroid[1])
                            .text(d.properties.name_en)


                        var tooltip = d3.select("#tooltip1");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-country").text(d.properties.name_en);


                        d3.json("AllTimeRankingByCountry.json").then(function (countryData) {
                            var country = countryData.find(function (item) {
                                return item.Country === d.properties.name_en;
                            });
                            if (country) {
                                tooltip.select("#tooltip-played1").text("Number of games Played: " + country.Played);
                            } else {
                                tooltip.select("#tooltip-played1").text("Played: N/A");
                            }
                        });
                    })

                    .on("mouseout", function () {

                        var tooltip = d3.select("#tooltip1");
                        tooltip.style("visibility", "hidden");
                    });
                svg.selectAll(".country-label")
                    .data(europeGeoJSON.features)
                    .enter().append("text")
                    .attr("class", "country-label")
                    .attr("transform", function (d) { return "translate(" + path.centroid(d) + ")"; })
                    .attr("dy", ".35em")
                    .text(function (d) { return d.properties.name_en; });
                countries.on("click", function (event, d) {
                    var countryName = d.properties.name_en;
                    loadTeamData(countryName);
                });
            });
            function loadTeamData(countryName) {
                d3.json("AllTimeRankingByClub.json")
                    .then(function (teamData) {
                        var teams = teamData.filter(function (team) {
                            return team.Country === countryName;
                        });
                        teams.sort(function (a, b) {
                            return b.Played - a.Played;
                        });
                        displayBarChart(teams);
                    });

            }
            function loadTeamData1(countryName) {
                d3.json("AllTimeRankingByClub.json")
                    .then(function (teamData) {
                        var teams = teamData.filter(function (team) {
                            return team.Country === countryName;
                        });
                        teams.sort(function (a, b) {
                            return b.Participated - a.Participated;
                        });
                        displayBarChart1(teams);
                    });

            }
            function loadTeamData2(countryName) {
                d3.json("AllTimeRankingByClub.json")
                    .then(function (teamData) {
                        var teams = teamData.filter(function (team) {
                            return team.Country === countryName;
                        });
                        teams.sort(function (a, b) {
                            return b.Goals_For - a.Goals_For;
                        });
                        displayBarChart2(teams);
                    });

            }

            function loadTeamData3(countryName) {
                d3.json("AllTimeRankingByClub.json")
                    .then(function (teamData) {
                        var teams = teamData.filter(function (team) {
                            return team.Country === countryName;
                        });
                        teams.sort(function (a, b) {
                            return b.Pts - a.Pts;
                        });
                        displayBarChart3(teams);
                    });

            }
            function loadTeamData4(countryName) {
                d3.json("AllTimeRankingByClub.json")
                    .then(function (teamData) {
                        var teams = teamData.filter(function (team) {
                            return team.Country === countryName;
                        });
                        teams.sort(function (a, b) {
                            return b.Titles - a.Titles;
                        });
                        displayBarChart4(teams);
                    });

            }

            function displayBarChart(teams) {
                d3.select("#bar-chart-container").selectAll("svg").remove()

                d3.select("#map-container").style("display", "none");
                d3.select("#bar-chart-container").style("display", "block");

                var chartContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var margin = { top: 50, right: 50, bottom: 130, left: 70 };
                var plotWidth = width - margin.left - margin.right;
                var plotHeight = height - margin.top - margin.bottom;

                var xScale = d3.scaleBand()
                    .domain(teams.map(function (team) { return team.Club; }))
                    .range([margin.left, margin.left + plotWidth])
                    .padding(0.1);

                var yScale = d3.scaleLinear()
                    .domain([0, d3.max(teams, function (team) { return team.Played; })])
                    .range([margin.top + plotHeight, margin.top]);

                var xAxis = d3.axisBottom(xScale);
                var yAxis = d3.axisLeft(yScale);


                chartContainer.selectAll(".bar")
                    .data(teams)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (team) { return xScale(team.Club); })
                    .attr("y", function () { return yScale(0); })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function () { return 0; })
                    .on("mousemove", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-club").text(d.Club);
                        tooltip.select("#tooltip-played").text("Played: " + d.Played);
                    })
                    .on("mouseout", function () {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");
                    });

                chartContainer.selectAll(".bar")
                    .transition()
                    .duration(800)
                    .delay(function (team, index) { return index * 100; })
                    .attr("y", function (team) { return yScale(team.Played); })
                    .attr("height", function (team) { return plotHeight - (yScale(team.Played) - margin.top); });

                chartContainer.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (margin.top + plotHeight) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("class", "bar-label")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "-0.5em")
                    .attr("transform", "rotate(-45)");

                chartContainer.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + margin.left + ",0)")
                    .call(yAxis);

                chartContainer.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", margin.top / 2)
                    .style("text-anchor", "middle")
                    .text("Number of Champion Leauge games played by clubs from " + teams[0].Country);
                var xAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", height - margin.bottom / 32) // Adjust the y position
                    .style("text-anchor", "middle")
                    .text("Team Name");

                var yAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", margin.left / 2)
                    .style("text-anchor", "middle")
                    .text("Games Played");

                var pieWidth = 400;
                var pieHeight = 300;
                var radius = Math.min(pieWidth, pieHeight) / 2;

                var pieContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", pieWidth)
                    .attr("height", pieHeight + 100)
                    .style("display", "none");

                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                var pie = d3.pie()
                    .value(function (d) { return d.value; })
                    .sort(null);

                function displayPieChart(team) {
                    pieContainer.selectAll("g").remove();
                    pieContainer.selectAll(".chart-title").remove();

                    var pieGroup = pieContainer.append("g")
                        .attr("transform", "translate(" + pieWidth / 2 + "," + (pieHeight / 2 + 70) + ")");

                    var pieData = [
                        { label: "Wins", value: team.Win },
                        { label: "Draws", value: team.Draw },
                        { label: "Losses", value: team.Loss }
                    ];

                    var slices = pieGroup.selectAll(".slice")
                        .data(pie(pieData))
                        .enter()
                        .append("g")
                        .attr("class", "slice");

                    slices.append("path")
                        .attr("d", arc)
                        .attr("fill", function (d) { return d.data.label === "Wins" ? "green" : (d.data.label === "Draws" ? "gray" : "red"); });

                    slices.append("text")
                        .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                        .attr("dy", ".35em")
                        .attr("text-anchor", "middle")
                        .text(function (d) { return d.data.label + ": " + d.data.value; });
                    pieContainer.append("text")
                        .attr("class", "chart-title")
                        .attr("x", pieWidth / 2)
                        .attr("y", 20)
                        .style("text-anchor", "middle")
                        .text(team.Club);
                }

                chartContainer.selectAll(".bar")
                    .on("click", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");

                        var pieChartVisible = pieContainer.style("display") !== "none";

                        if (pieChartVisible) {
                            pieContainer.style("display", "none");
                        } else {
                            displayPieChart(d);
                            pieContainer.style("display", "block");
                        }
                    });

                d3.select(".back-button")
                    .on("click", function () {
                        d3.select("#map-container").style("display", "block");
                        d3.select("#bar-chart-container").style("display", "none");

                        chartContainer.transition()
                            .duration(800)
                            .style("opacity", 0)
                            .remove();

                    });

                d3.select(".participated-button")
                    .on("click", function () {

                        var selectedCountry = teams[0].Country;
                        loadTeamData1(selectedCountry);

                    });

                d3.select(".played-button")
                    .on("click", function () {

                        var selectedCountry = teams[0].Country;
                        loadTeamData(selectedCountry);

                    });

                d3.select(".scored-button")
                    .on("click", function () {

                        var selectedCountry = teams[0].Country;
                        loadTeamData2(selectedCountry);

                    });

                d3.select(".points-button")
                    .on("click", function () {

                        var selectedCountry = teams[0].Country;
                        loadTeamData3(selectedCountry);

                    });
                d3.select(".titles-button")
                    .on("click", function () {

                        var selectedCountry = teams[0].Country;
                        loadTeamData4(selectedCountry);

                    });
            }

            function displayBarChart1(teams) {
                d3.select("#bar-chart-container").selectAll("svg").remove()

                d3.select("#bar-chart-container").style("display", "block");

                var chartContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var margin = { top: 50, right: 50, bottom: 130, left: 70 };
                var plotWidth = width - margin.left - margin.right;
                var plotHeight = height - margin.top - margin.bottom;

                var xScale = d3.scaleBand()
                    .domain(teams.map(function (team) { return team.Club; }))
                    .range([margin.left, margin.left + plotWidth])
                    .padding(0.1);

                var yScale = d3.scaleLinear()
                    .domain([0, d3.max(teams, function (team) { return team.Participated; })])
                    .range([margin.top + plotHeight, margin.top]);

                var xAxis = d3.axisBottom(xScale);
                var yAxis = d3.axisLeft(yScale);


                chartContainer.selectAll(".bar")
                    .data(teams)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (team) { return xScale(team.Club); })
                    .attr("y", function () { return yScale(0); })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function () { return 0; })
                    .on("mousemove", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-club").text(d.Club);
                        tooltip.select("#tooltip-played").text("Participated: " + d.Participated);
                    })
                    .on("mouseout", function () {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");
                    });

                chartContainer.selectAll(".bar")
                    .transition()
                    .duration(800)
                    .delay(function (team, index) { return index * 100; })
                    .attr("y", function (team) { return yScale(team.Participated); })
                    .attr("height", function (team) { return plotHeight - (yScale(team.Participated) - margin.top); });

                chartContainer.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (margin.top + plotHeight) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("class", "bar-label")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "-0.5em")
                    .attr("transform", "rotate(-45)");

                chartContainer.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + margin.left + ",0)")
                    .call(yAxis);

                chartContainer.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", margin.top / 2)
                    .style("text-anchor", "middle")
                    .text("Number of seasons participated in Champions League by clubs from " + teams[0].Country);
                var xAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", height - margin.bottom / 32)
                    .style("text-anchor", "middle")
                    .text("Team Name");

                var yAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", margin.left / 2)
                    .style("text-anchor", "middle")
                    .text("Seasons Participated");

                var pieWidth = 400;
                var pieHeight = 300;
                var radius = Math.min(pieWidth, pieHeight) / 2;

                var pieContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", pieWidth)
                    .attr("height", pieHeight + 100)
                    .style("display", "none");

                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                var pie = d3.pie()
                    .value(function (d) { return d.value; })
                    .sort(null);

                function displayPieChart(team) {
                    pieContainer.selectAll("g").remove();
                    pieContainer.selectAll(".chart-title").remove();

                    var pieGroup = pieContainer.append("g")
                        .attr("transform", "translate(" + pieWidth / 2 + "," + (pieHeight / 2 + 70) + ")");


                    var pieData = [
                        { label: "Wins", value: team.Win },
                        { label: "Draws", value: team.Draw },
                        { label: "Losses", value: team.Loss }
                    ];

                    var slices = pieGroup.selectAll(".slice")
                        .data(pie(pieData))
                        .enter()
                        .append("g")
                        .attr("class", "slice");

                    slices.append("path")
                        .attr("d", arc)
                        .attr("fill", function (d) { return d.data.label === "Wins" ? "green" : (d.data.label === "Draws" ? "gray" : "red"); });

                    slices.append("text")
                        .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                        .attr("dy", ".35em")
                        .attr("text-anchor", "middle")
                        .text(function (d) { return d.data.label + ": " + d.data.value; });

                    pieContainer.append("text")
                        .attr("class", "chart-title")
                        .attr("x", pieWidth / 2)
                        .attr("y", 20)
                        .style("text-anchor", "middle")
                        .text(team.Club)

                }

                chartContainer.selectAll(".bar")
                    .on("click", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");

                        var pieChartVisible = pieContainer.style("display") !== "none";

                        if (pieChartVisible) {
                            pieContainer.style("display", "none");
                        } else {
                            displayPieChart(d);
                            pieContainer.style("display", "block");
                        }
                    });

                d3.select(".back-button")
                    .on("click", function () {
                        d3.select("#map-container").style("display", "block");
                        d3.select("#bar-chart-container").style("display", "none");
                        chartContainer.remove

                    });

            }
            function displayBarChart2(teams) {
                d3.select("#bar-chart-container").selectAll("svg").remove()
                d3.select("#bar-chart-container").style("display", "block");

                d3.select("#bar-chart-container").selectAll("svg").remove()

                var chartContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var margin = { top: 50, right: 50, bottom: 130, left: 70 };
                var plotWidth = width - margin.left - margin.right;
                var plotHeight = height - margin.top - margin.bottom;

                var xScale = d3.scaleBand()
                    .domain(teams.map(function (team) { return team.Club; }))
                    .range([margin.left, margin.left + plotWidth])
                    .padding(0.1);

                var yScale = d3.scaleLinear()
                    .domain([0, d3.max(teams, function (team) { return team.Goals_For; })])
                    .range([margin.top + plotHeight, margin.top]);

                var xAxis = d3.axisBottom(xScale);
                var yAxis = d3.axisLeft(yScale);


                chartContainer.selectAll(".bar")
                    .data(teams)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (team) { return xScale(team.Club); })
                    .attr("y", function () { return yScale(0); })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function () { return 0; })
                    .on("mousemove", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-club").text(d.Club);
                        tooltip.select("#tooltip-played").text("Goals Scored: " + d.Goals_For);
                    })
                    .on("mouseout", function () {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");
                    });

                chartContainer.selectAll(".bar")
                    .transition()
                    .duration(800)
                    .delay(function (team, index) { return index * 100; })
                    .attr("y", function (team) { return yScale(team.Goals_For); })
                    .attr("height", function (team) { return plotHeight - (yScale(team.Goals_For) - margin.top); });

                chartContainer.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (margin.top + plotHeight) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("class", "bar-label")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "-0.5em")
                    .attr("transform", "rotate(-45)");

                chartContainer.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + margin.left + ",0)")
                    .call(yAxis);

                chartContainer.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", margin.top / 2)
                    .style("text-anchor", "middle")
                    .text("Number of goals scored in Champions League by clubs from " + teams[0].Country);
                var xAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", height - margin.bottom / 32)
                    .style("text-anchor", "middle")
                    .text("Team Name");

                var yAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", margin.left / 2)
                    .style("text-anchor", "middle")
                    .text("Goals Scored");

                var pieWidth = 400;
                var pieHeight = 300;
                var radius = Math.min(pieWidth, pieHeight) / 2;

                var pieContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", pieWidth)
                    .attr("height", pieHeight + 100)
                    .style("display", "none");

                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                var pie = d3.pie()
                    .value(function (d) { return d.value; })
                    .sort(null);

                function displayPieChart(team) {
                    pieContainer.selectAll("g").remove();
                    pieContainer.selectAll(".chart-title").remove();

                    var pieGroup = pieContainer.append("g")
                        .attr("transform", "translate(" + pieWidth / 2 + "," + (pieHeight / 2 + 70) + ")");


                    var pieData = [
                        { label: "Wins", value: team.Win },
                        { label: "Draws", value: team.Draw },
                        { label: "Losses", value: team.Loss }
                    ];

                    var slices = pieGroup.selectAll(".slice")
                        .data(pie(pieData))
                        .enter()
                        .append("g")
                        .attr("class", "slice");

                    slices.append("path")
                        .attr("d", arc)
                        .attr("fill", function (d) { return d.data.label === "Wins" ? "green" : (d.data.label === "Draws" ? "gray" : "red"); });

                    slices.append("text")
                        .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                        .attr("dy", ".35em")
                        .attr("text-anchor", "middle")
                        .text(function (d) { return d.data.label + ": " + d.data.value; });

                    pieContainer.append("text")
                        .attr("class", "chart-title")
                        .attr("x", pieWidth / 2)
                        .attr("y", 20)
                        .style("text-anchor", "middle")
                        .text(team.Club);
                }

                chartContainer.selectAll(".bar")
                    .on("click", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");

                        var pieChartVisible = pieContainer.style("display") !== "none";

                        if (pieChartVisible) {
                            pieContainer.style("display", "none");
                        } else {
                            displayPieChart(d);
                            pieContainer.style("display", "block");
                        }
                    });

                d3.select(".back-button")
                    .on("click", function () {
                        d3.select("#map-container").style("display", "block");
                        d3.select("#bar-chart-container").style("display", "none");
                        chartContainer.remove

                    });
            }

            function displayBarChart3(teams) {
                d3.select("#bar-chart-container").selectAll("svg").remove()
                d3.select("#bar-chart-container").style("display", "block");

                d3.select("#bar-chart-container").selectAll("svg").remove()

                var chartContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var margin = { top: 50, right: 50, bottom: 130, left: 70 };
                var plotWidth = width - margin.left - margin.right;
                var plotHeight = height - margin.top - margin.bottom;

                var xScale = d3.scaleBand()
                    .domain(teams.map(function (team) { return team.Club; }))
                    .range([margin.left, margin.left + plotWidth])
                    .padding(0.1);

                var yScale = d3.scaleLinear()
                    .domain([0, d3.max(teams, function (team) { return team.Pts; })])
                    .range([margin.top + plotHeight, margin.top]);

                var xAxis = d3.axisBottom(xScale);
                var yAxis = d3.axisLeft(yScale);


                chartContainer.selectAll(".bar")
                    .data(teams)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (team) { return xScale(team.Club); })
                    .attr("y", function () { return yScale(0); })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function () { return 0; })
                    .on("mousemove", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-club").text(d.Club);
                        tooltip.select("#tooltip-played").text("Team Points: " + d.Pts);
                    })
                    .on("mouseout", function () {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");
                    });

                chartContainer.selectAll(".bar")
                    .transition()
                    .duration(800)
                    .delay(function (team, index) { return index * 100; })
                    .attr("y", function (team) { return yScale(team.Pts); })
                    .attr("height", function (team) { return plotHeight - (yScale(team.Pts) - margin.top); });

                chartContainer.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (margin.top + plotHeight) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("class", "bar-label")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "-0.5em")
                    .attr("transform", "rotate(-45)");

                chartContainer.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + margin.left + ",0)")
                    .call(yAxis);

                chartContainer.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", margin.top / 2)
                    .style("text-anchor", "middle")
                    .text("Number of points won in Champions League  by clubs from " + teams[0].Country);

                var xAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", height - margin.bottom / 32)
                    .style("text-anchor", "middle")
                    .text("Team Name");

                var yAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", margin.left / 2)
                    .style("text-anchor", "middle")
                    .text("Points");

                var pieWidth = 400;
                var pieHeight = 300;
                var radius = Math.min(pieWidth, pieHeight) / 2;

                var pieContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", pieWidth)
                    .attr("height", pieHeight + 100)
                    .style("display", "none");

                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                var pie = d3.pie()
                    .value(function (d) { return d.value; })
                    .sort(null);

                function displayPieChart(team) {
                    pieContainer.selectAll("g").remove();
                    pieContainer.selectAll(".chart-title").remove();

                    var pieGroup = pieContainer.append("g")
                        .attr("transform", "translate(" + pieWidth / 2 + "," + (pieHeight / 2 + 70) + ")");


                    var pieData = [
                        { label: "Wins", value: team.Win },
                        { label: "Draws", value: team.Draw },
                        { label: "Losses", value: team.Loss }
                    ];

                    var slices = pieGroup.selectAll(".slice")
                        .data(pie(pieData))
                        .enter()
                        .append("g")
                        .attr("class", "slice");

                    slices.append("path")
                        .attr("d", arc)
                        .attr("fill", function (d) { return d.data.label === "Wins" ? "green" : (d.data.label === "Draws" ? "gray" : "red"); });

                    slices.append("text")
                        .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                        .attr("dy", ".35em")
                        .attr("text-anchor", "middle")
                        .text(function (d) { return d.data.label + ": " + d.data.value; });

                    pieContainer.append("text")
                        .attr("class", "chart-title")
                        .attr("x", pieWidth / 2)
                        .attr("y", 20)
                        .style("text-anchor", "middle")
                        .text(team.Club);
                }

                chartContainer.selectAll(".bar")
                    .on("click", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");

                        var pieChartVisible = pieContainer.style("display") !== "none";

                        if (pieChartVisible) {
                            pieContainer.style("display", "none");
                        } else {
                            displayPieChart(d);
                            pieContainer.style("display", "block");
                        }
                    });

                d3.select(".back-button")
                    .on("click", function () {
                        d3.select("#map-container").style("display", "block");
                        d3.select("#bar-chart-container").style("display", "none");
                        chartContainer.remove

                    });
            }
            function displayBarChart4(teams) {
                d3.select("#bar-chart-container").selectAll("svg").remove()
                d3.select("#bar-chart-container").style("display", "block");

                var chartContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var margin = { top: 50, right: 50, bottom: 130, left: 70 };
                var plotWidth = width - margin.left - margin.right;
                var plotHeight = height - margin.top - margin.bottom;

                var xScale = d3.scaleBand()
                    .domain(teams.map(function (team) { return team.Club; }))
                    .range([margin.left, margin.left + plotWidth])
                    .padding(0.1);

                var yScale = d3.scaleLinear()
                    .domain([0, d3.max(teams, function (team) { return team.Titles; })])
                    .range([margin.top + plotHeight, margin.top]);

                var xAxis = d3.axisBottom(xScale);
                var yAxis = d3.axisLeft(yScale);


                chartContainer.selectAll(".bar")
                    .data(teams)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (team) { return xScale(team.Club); })
                    .attr("y", function () { return yScale(0); })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function () { return 0; })
                    .on("mousemove", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "visible")
                            .style("top", (event.pageY - 10) + "px")
                            .style("left", (event.pageX + 10) + "px");
                        tooltip.select("#tooltip-club").text(d.Club);
                        tooltip.select("#tooltip-played").text("Team Titles: " + d.Titles);
                    })
                    .on("mouseout", function () {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");
                    });

                chartContainer.selectAll(".bar")
                    .transition()
                    .duration(800)
                    .delay(function (team, index) { return index * 100; })
                    .attr("y", function (team) { return yScale(team.Titles); })
                    .attr("height", function (team) { return plotHeight - (yScale(team.Titles) - margin.top); });





                chartContainer.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (margin.top + plotHeight) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("class", "bar-label")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "-0.5em")
                    .attr("transform", "rotate(-45)");

                chartContainer.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + margin.left + ",0)")
                    .call(yAxis);

                chartContainer.append("text")
                    .attr("class", "chart-title")
                    .attr("x", width / 2)
                    .attr("y", margin.top / 2)
                    .style("text-anchor", "middle")
                    .text("Number of Champions Leauge Titles  by clubs from " + teams[0].Country);

                var xAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("x", width / 2)
                    .attr("y", height - margin.bottom / 32)
                    .style("text-anchor", "middle")
                    .text("Team Name");

                var yAxisLabel = chartContainer.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2)
                    .attr("y", margin.left / 2)
                    .style("text-anchor", "middle")
                    .text("Titles");

                var pieWidth = 400;
                var pieHeight = 300;
                var radius = Math.min(pieWidth, pieHeight) / 2;

                var pieContainer = d3.select("#bar-chart-container")
                    .append("svg")
                    .attr("width", pieWidth)
                    .attr("height", pieHeight + 100)
                    .style("display", "none");

                var arc = d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius);

                var pie = d3.pie()
                    .value(function (d) { return d.value; })
                    .sort(null);

                function displayPieChart(team) {
                    pieContainer.selectAll("g").remove();
                    pieContainer.selectAll(".chart-title").remove();

                    var pieGroup = pieContainer.append("g")
                        .attr("transform", "translate(" + pieWidth / 2 + "," + (pieHeight / 2 + 70) + ")");


                    var pieData = [
                        { label: "Wins", value: team.Win },
                        { label: "Draws", value: team.Draw },
                        { label: "Losses", value: team.Loss }
                    ];

                    var slices = pieGroup.selectAll(".slice")
                        .data(pie(pieData))
                        .enter()
                        .append("g")
                        .attr("class", "slice");

                    slices.append("path")
                        .attr("d", arc)
                        .attr("fill", function (d) { return d.data.label === "Wins" ? "green" : (d.data.label === "Draws" ? "gray" : "red"); });

                    slices.append("text")
                        .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                        .attr("dy", ".35em")
                        .attr("text-anchor", "middle")
                        .text(function (d) { return d.data.label + ": " + d.data.value; });

                    pieContainer.append("text")
                        .attr("class", "chart-title")
                        .attr("x", pieWidth / 2)
                        .attr("y", 20)
                        .style("text-anchor", "middle")
                        .text(team.Club);
                }

                chartContainer.selectAll(".bar")
                    .on("click", function (event, d) {
                        var tooltip = d3.select("#tooltip");
                        tooltip.style("visibility", "hidden");

                        var pieChartVisible = pieContainer.style("display") !== "none";

                        if (pieChartVisible) {
                            pieContainer.style("display", "none");
                        } else {
                            displayPieChart(d);
                            pieContainer.style("display", "block");
                        }
                    });

                d3.select(".back-button")
                    .on("click", function () {
                        d3.select("#map-container").style("display", "block");
                        d3.select("#bar-chart-container").style("display", "none");
                        chartContainer.remove

                    });
            }


        });
    </script>
</body>

</html>